{{ define "title" }}Notes · {{ .Site.Title }}{{ end }}

{{ define "content" }}
  <section class="container page list">
    <header>
      <h1>My 'personal' Notes</h1>
    </header>
    This is where I store notes on tech, articles, videos, and books that caught my attention. It helps me organize my
    thoughts—and maybe it'll help you too.

    <div class="notes-intro">
      {{ $notesPage := $.Site.GetPage "/notes" }}
      {{ if $notesPage }}
        {{ $notesPage.Content }}
      {{ end }}
    </div>

    {{ $current := .RelPermalink }}


    <div class="list-filter">
      <a href="/notes/" {{ if eq $current "/notes/" }}class="active"{{ end }}>All</a>

      {{ range $name, $taxonomy := .Site.Taxonomies.categories }}
        {{ with $.Site.GetPage (printf "/categories/%s" $name) }}
          |
          <a
            href="{{ .RelPermalink }}"
            {{ if eq $current .RelPermalink }}class="filter-item active"{{ end }}
            >{{ .Title }}</a
          >
        {{ end }}
      {{ end }}

    </div>

    <ul>
      {{ range .Pages.ByDate.Reverse }}
        <li>
          <a href="{{ .RelPermalink }}">{{ .Title }}</a>

          <span class="additional-info" data-path="{{ .RelPermalink }}"></span>
          <span>{{ .Date.Format "2006-01-02" }}</span>
        </li>
      {{ else }}
        <p>No notes found in this category yet.</p>
      {{ end }}
    </ul>
  </section>
  <script>
    (() => {
      fetch('{{ "comments-stats.json" | absURL }}')
        .then(response => {
          if (!response.ok) {
            throw new Error("Network response was not ok: " + response.statusText);
          }
          return response.json();
        })
        .then(stats => {
          console.log("Comments stats loaded:", stats);

          document.querySelectorAll(".additional-info").forEach(el => {
            let path = el.getAttribute("data-path");
            if (path.startsWith('/')) {
              path = path.substring(1);
            }
            const commentCount = (stats[path] && stats[path].comments) ? stats[path].comments : 0;
            el.innerText = `(${commentCount} comments)`;
          });
        })
        .catch(e => {
          console.error("Error during loading comments count:", e);
          document.querySelectorAll(".additional-info").forEach(el => {
            el.style.display = "none";
          });
        });
    })();
  </script>
{{ end }}
