{{ $keepItSimple := .Site.Params.keepItSimple }}
<section class="container">
  <nav class="top-nav">
    <div class="top-nav-left">
      <a class="top-nav-title" href="{{ .Site.BaseURL }}">
        {{ .Site.Title }}
      </a>
    </div>
    <div class="top-nav-right">
      <input hidden type="checkbox" id="menu-toggle" />
      <input hidden type="checkbox" id="theme-toggle" checked />
      <input hidden type="checkbox" id="contrast-toggle" />
      <script>
        (() => {
          const setupToggle = ({ _id, storageKey, titleOn, titleOff }) => {
            const id = _id + "-toggle";
            const toggle = document.getElementById(id);
            const label = document.querySelector(`label[for="${id}"]`);
            if (!toggle || !label) return;

            if (storageKey) {
              const saved = localStorage.getItem(storageKey);
              if (saved !== null) {
                toggle.checked = saved === "true";
              }
            }

            const updateTitle = () => {
              label.title = toggle.checked ? titleOn : titleOff;
            };

            updateTitle();

            toggle.addEventListener("change", () => {
              if (storageKey) {
                localStorage.setItem(storageKey, toggle.checked);
              }
              updateTitle();
            });
          };

          setupToggle({
            id: "theme",
            storageKey: "theme",
            titleOn: "Switch to Light mode",
            titleOff: "Switch to Dark mode",
          });

          setupToggle({
            id: "contrast",
            storageKey: "contrast",
            titleOn: "Turn OFF High Contrast",
            titleOff: "Turn ON High Contrast",
          });

          setupToggle({
            id: "menu",
            storageKey: null,
            titleOn: "Close Menu",
            titleOff: "Open Menu",
          });
        })();
      </script>
      {{ with .Site.Menus.main }}
        <label for="menu-toggle" class="mobile-menu">
          {{ if $keepItSimple }}
            Menu
          {{ else }}
            {{ partial "icons/menu.html" . }}
          {{ end }}
        </label>
        <ul id="top-nav-items" class="top-nav-list">
          {{ partial "icons/arrow.html" . }}
          {{ range sort . }}
            {{ $isActive := false }}
            {{ if eq $.Page.RelPermalink .URL }}
              {{ $isActive = true }}
            {{ else if and (ne .URL "/") (hasPrefix $.Page.RelPermalink .URL) }}
              {{ $isActive = true }}
            {{ else if and (eq .URL "/") (eq $.Page.Type "homepage") }}
              {{ $isActive = true }}
            {{ end }}
            <li class="top-nav-item {{ if $isActive }}is-active{{ end }}">
              <a class="top-nav-link" href="{{ .URL }}">{{ .Name }}</a>
            </li>
          {{ end }}
          <li class="top-nav-item">
            <label
              class="top-nav-link theme-toggle"
              for="theme-toggle"
              aria-label="Toggle dark mode"
              title="Switch between light and dark theme">
              {{ if $keepItSimple }}
                <span class="theme-char theme-icon-sun">☀</span><span class="theme-char theme-icon-moon">☾</span>
              {{ else }}
                {{ partial "icons/sun.html" . }}{{ partial "icons/moon.html" . }}
              {{ end }}
            </label>
            <label
              class="top-nav-link contrast-toggle"
              for="contrast-toggle"
              aria-label="Toggle high contrast"
              title="Switch between low and high contrast colors">
              {{ if $keepItSimple }}
                <span class="contrast-char">◐</span>
              {{ else }}
                {{ partial "icons/contrast.html" . }}
              {{ end }}
            </label>
          </li>
        </ul>
      {{ end }}
    </div>
  </nav>
</section>
