<script>
  window.sendToGiscus = function (config) {
    const iframe = document.querySelector("iframe.giscus-frame");
    if (iframe?.contentWindow) {
      iframe.contentWindow.postMessage({ giscus: { setConfig: config } }, "https://giscus.app");
    }
  };

  window.addEventListener("app:prefs-changed", event => {
    const { source, newValue } = event.detail;
    if (source === "theme-toggle") {
      const newTheme = newValue ? "gruvbox_dark" : "gruvbox_light";
      window.sendToGiscus({ theme: newTheme });
    }
  });
</script>

<script
  src="https://giscus.app/client.js"
  data-repo="alfonsZelicko/personal-website"
  data-repo-id="R_kgDOQps9WA"
  data-category="Announcements"
  data-category-id="DIC_kwDOQps9WM4C0PZs"
  data-mapping="pathname"
  data-strict="0"
  data-reactions-enabled="1"
  data-emit-metadata="0"
  data-input-position="bottom"
  data-theme="gruvbox_dark"
  id="giscus-script"
  crossorigin="anonymous"
  async></script>

<script>
  (() => {
    const isDarkTheme = localStorage.getItem("isDarkTheme") !== "false";
    const giscusTheme = isDarkTheme ? "gruvbox_dark" : "gruvbox_light";
    const script = document.getElementById("giscus-script");

    if (script && script.getAttribute("data-theme") !== giscusTheme) {
      script.setAttribute("data-theme", giscusTheme);
    }
  })();
</script>
